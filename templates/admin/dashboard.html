{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ title }} â€“ CopalSchool{% endblock %}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-md">

    <!-- =======================
         ADMIN DASHBOARD HEADER
    ======================== -->
    <h2 class="text-2xl font-bold mb-6">{% trans "Admin Dashboard" %}</h2>

    <!-- =======================
         STUDENTS BY CLASS
    ======================== -->
    <section class="bg-gray-50 p-4 rounded mb-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">{% trans "Students by Class" %}</h3>
            <a href="{% url 'schoolcopal:eleve_create' %}"
               class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                {% trans "Add Student" %}
            </a>
        </div>
        <a href="{% url 'schoolcopal:eleve_list' %}" class="text-blue-500 mb-2 inline-block">
            {% trans "View All Students" %}
        </a>

        {% for classe, eleves in eleves_by_class.items %}
            <h4 class="text-md font-medium mt-4">
                {% trans "Class" %}: {{ classe }}
                <span class="text-gray-600">
                    ({% trans "Number of Students" %}: {{ eleves|length }})
                </span>
            </h4>

            <table class="w-full border-collapse border border-gray-300 mt-2">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="border px-4 py-2">{% trans "First Name" %}</th>
                        <th class="border px-4 py-2">{% trans "Last Name" %}</th>
                        <th class="border px-4 py-2">{% trans "Gender" %}</th>
                        <th class="border px-4 py-2">{% trans "Actions" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for eleve in eleves %}
                        <tr>
                            <td class="border px-4 py-2">{{ eleve.prenom }}</td>
                            <td class="border px-4 py-2">{{ eleve.nom }}</td>
                            <td class="border px-4 py-2">{{ eleve.sexe }}</td>
                            <td class="border px-4 py-2">
                                <a href="{% url 'schoolcopal:eleve_update' eleve.pk %}"
                                   class="text-blue-500 hover:underline">{% trans "Edit" %}</a>
                                <a href="{% url 'schoolcopal:eleve_delete' eleve.pk %}"
                                   class="text-red-500 hover:underline ml-2"
                                >
                                    {% trans "Delete" %}
                                </a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4" class="text-center border px-4 py-2">
                                {% trans "No students in this class." %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    </section>

    <!-- =======================
         TEACHERS LIST
    ======================== -->
    <section class="bg-gray-50 p-4 rounded mb-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">{% trans "Teachers List" %}</h3>
            <a href="{% url 'schoolcopal:enseignant_create' %}"
               class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                {% trans "Add Teacher" %}
            </a>
        </div>
        <a href="{% url 'schoolcopal:enseignant_list' %}" class="text-blue-500 mb-2 inline-block">
            {% trans "View All Teachers" %}
        </a>

        <table class="w-full border-collapse border border-gray-300">
            <thead class="bg-gray-200">
                <tr>
                    <th class="border px-4 py-2">{% trans "Username" %}</th>
                    <th class="border px-4 py-2">{% trans "Class" %}</th>
                    <th class="border px-4 py-2">{% trans "Salary" %}</th>
                    <th class="border px-4 py-2">{% trans "telephone" %}</th>
                    <th class="border px-4 py-2">{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for enseignant in enseignants %}
                    <tr>
                        <td class="border px-4 py-2">{{enseignant.user.get_full_name|default:enseignant.user.username}}</td>
                        <td class="border px-4 py-2">{{ enseignant.classe|default:_("No Class") }}</td>
                        <td class="border px-4 py-2">{{ enseignant.salaire }} FCFA</td>
                        <td class="border px-4 py-2">{{ enseignant.user.telephone }}</td>
                        <td class="border px-4 py-2">
                            <a href="{% url 'schoolcopal:enseignant_update' enseignant.pk %}"
                               class="text-blue-500 hover:underline">{% trans "Edit" %}</a>
                            <a href="{% url 'schoolcopal:enseignant_delete' enseignant.pk %}"
                               class="text-red-500 hover:underline ml-2"
                            >
                                {% trans "Delete" %}
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4" class="text-center border px-4 py-2">
                            {% trans "No teachers." %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- =======================
         SUBJECTS BY CLASS
    ======================== -->
    <section class="bg-gray-50 p-4 rounded mb-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">{% trans "Subjects by Class" %}</h3>
            <a href="{% url 'schoolcopal:matiere_create' %}"
               class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                {% trans "Add Subject" %}
            </a>
        </div>
        <a href="{% url 'schoolcopal:matiere_list' %}" class="text-blue-500 mb-2 inline-block">
            {% trans "View All Subjects" %}
        </a>

        {% for classe, matieres in matieres_by_class.items %}
            <h4 class="text-md font-medium mt-4">{% trans "Class" %}: {{ classe }}</h4>
            <table class="w-full border-collapse border border-gray-300 mt-2">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="border px-4 py-2">{% trans "Subject Name" %}</th>
                        <th class="border px-4 py-2">{% trans "Description" %}</th>
                        <th class="border px-4 py-2">{% trans "Actions" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for matiere in matieres %}
                        <tr>
                            <td class="border px-4 py-2">{{ matiere.nom }}</td>
                            <td class="border px-4 py-2">{{ matiere.description|default:_("No description") }}</td>
                            <td class="border px-4 py-2">
                                <a href="{% url 'schoolcopal:matiere_update' matiere.pk %}"
                                   class="text-blue-500 hover:underline">{% trans "Edit" %}</a>
                                <a href="{% url 'schoolcopal:matiere_delete' matiere.pk %}"
                                   class="text-red-500 hover:underline ml-2"
                                >
                                    {% trans "Delete" %}
                                </a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="3" class="text-center border px-4 py-2">
                                {% trans "No subjects for this class." %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    </section>

    <!-- =======================
         CLASSES
    ======================== -->
    <section class="bg-gray-50 p-4 rounded mb-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">{% trans "Classes List" %}</h3>
            <a href="{% url 'schoolcopal:classescolaire_create' %}"
               class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                {% trans "Add Class" %}
            </a>
        </div>
        <a href="{% url 'schoolcopal:classescolaire_list' %}" class="text-blue-500 mb-2 inline-block">
            {% trans "View All Classes" %}
        </a>

        <table class="w-full border-collapse border border-gray-300">
            <thead class="bg-gray-200">
                <tr>
                    <th class="border px-4 py-2">{% trans "Level" %}</th>
                    <th class="border px-4 py-2">{% trans "Section" %}</th>
                    <th class="border px-4 py-2">{% trans "Capacity" %}</th>
                    <th class="border px-4 py-2">{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for classe in classes %}
                    <tr>
                        <td class="border px-4 py-2">{{ classe.niveau }}</td>
                        <td class="border px-4 py-2">{{ classe.section }}</td>
                        <td class="border px-4 py-2">{{ classe.capacite }}</td>
                        <td class="border px-4 py-2">
                            <a href="{% url 'schoolcopal:classescolaire_update' classe.pk %}"
                               class="text-blue-500 hover:underline">{% trans "Edit" %}</a>
                            <a href="{% url 'schoolcopal:classescolaire_delete' classe.pk %}"
                               class="text-red-500 hover:underline ml-2"
                            >
                                {% trans "Delete" %}
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4" class="text-center border px-4 py-2">
                            {% trans "No classes." %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- =======================
         DIRECTORS
    ======================== -->
    <section class="bg-gray-50 p-4 rounded mb-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">{% trans "Directors List" %}</h3>
            <a href="{% url 'schoolcopal:directeur_create' %}"
               class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                {% trans "Add Director" %}
            </a>
        </div>
        <a href="{% url 'schoolcopal:directeur_list' %}" class="text-blue-500 mb-2 inline-block">
            {% trans "View All Directors" %}
        </a>

        <table class="w-full border-collapse border border-gray-300">
            <thead class="bg-gray-200">
                <tr>
                    <th class="border px-4 py-2">{% trans "Username" %}</th>
                    <th class="border px-4 py-2">{% trans "Email" %}</th>
                    <th class="border px-4 py-2">{% trans "Telephone" %}</th>
                    <th class="border px-4 py-2">{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for directeur in directeurs %}
                    <tr>
                        <td class="border px-4 py-2">{{ directeur.username }}</td>
                        <td class="border px-4 py-2">{{ directeur.email }}</td>
                        <td class="border px-4 py-2">{{ directeur.telephone|default:"N/A" }}</td>
                        <td class="border px-4 py-2">
                            <a href="{% url 'schoolcopal:directeur_update' directeur.pk %}"
                               class="text-blue-500 hover:underline">{% trans "Edit" %}</a>
                            <a href="{% url 'schoolcopal:directeur_delete' directeur.pk %}"
                               class="text-red-500 hover:underline ml-2"
                            >
                                {% trans "Delete" %}
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4" class="text-center border px-4 py-2">
                            {% trans "No directors." %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
    <!-- =======================
         ADMINS
    ======================== -->
    <section class="bg-gray-50 p-4 rounded mb-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold">{% trans "Admins List" %}</h3>
            <a href="{% url 'schoolcopal:admin_create' %}"
               class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                {% trans "Add Admin" %}
            </a>
        </div>
        <a href="{% url 'schoolcopal:admin_list' %}" class="text-blue-500 mb-2 inline-block">
            {% trans "View All Admins" %}
        </a>

        <table class="w-full border-collapse border border-gray-300">
            <thead class="bg-gray-200">
                <tr>
                    <th class="border px-4 py-2">{% trans "Username" %}</th>
                    <th class="border px-4 py-2">{% trans "Email" %}</th>
                    <th class="border px-4 py-2">{% trans "Telephone" %}</th>
                    <th class="border px-4 py-2">{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for admin in admins %}
                    <tr>
                        <td class="border px-4 py-2">{{ admin.username }}</td>
                        <td class="border px-4 py-2">{{ admin.email }}</td>
                        <td class="border px-4 py-2">{{ admin.telephone|default:"N/A" }}</td>
                        <td class="border px-4 py-2">
                            <a href="{% url 'schoolcopal:admin_update' admin.pk %}"
                               class="text-blue-500 hover:underline">{% trans "Edit" %}</a>
                            <a href="{% url 'schoolcopal:admin_delete' admin.pk %}"
                               class="text-red-500 hover:underline ml-2">
                                {% trans "Delete" %}
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4" class="text-center border px-4 py-2">
                            {% trans "No admins found." %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- =======================
         STATISTICS CARDS
    ======================== -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-blue-50 p-4 rounded text-center">
            <h3 class="text-lg font-semibold">{% trans "Total Users" %}</h3>
            <p class="text-3xl font-bold">{{ total_users }}</p>
            <a href="{% url 'admin:schoolcopal_user_changelist' %}" class="text-blue-500">
                {% trans "Manage Users" %}
            </a>
        </div>
        <div class="bg-green-50 p-4 rounded text-center">
            <h3 class="text-lg font-semibold">{% trans "Total Students" %}</h3>
            <p class="text-3xl font-bold">{{ total_students }}</p>
            <a href="{% url 'schoolcopal:eleve_list' %}" class="text-blue-500">
                {% trans "Manage Students" %}
            </a>
        </div>
        <div class="bg-yellow-50 p-4 rounded text-center">
            <h3 class="text-lg font-semibold">{% trans "Total Teachers" %}</h3>
            <p class="text-3xl font-bold">{{ total_teachers }}</p>
            <a href="{% url 'schoolcopal:enseignant_list' %}" class="text-blue-500">
                {% trans "Manage Teachers" %}
            </a>
        </div>
        <div class="bg-purple-50 p-4 rounded text-center">
            <h3 class="text-lg font-semibold">{% trans "Total Classes" %}</h3>
            <p class="text-3xl font-bold">{{ total_classes }}</p>
            <a href="{% url 'schoolcopal:classescolaire_list' %}" class="text-blue-500">
                {% trans "Manage Classes" %}
            </a>
        </div>
        

        <div class="bg-red-50 p-4 rounded text-center">
            <h3 class="text-lg font-semibold">{% trans "Total Admins" %}</h3>
            <p class="text-3xl font-bold">{{ total_admins }}</p>
            <a href="{% url 'schoolcopal:admin_list' %}" class="text-blue-500">
                {% trans "Manage Admins" %}
            </a>
        </div>
    </div>

    <!-- =======================
         PENDING PAYMENTS
    ======================== -->
    <section class="bg-gray-50 p-4 rounded mb-6">
        <h3 class="text-lg font-semibold mb-2">{% trans "Pending Payments" %}</h3>
        <p class="text-2xl font-bold">{{ pending_payments }}</p>
    </section>

    <!-- =======================
         RECENT NOTIFICATIONS
    ======================== -->
    <section class="bg-gray-50 p-4 rounded">
        <h3 class="text-lg font-semibold mb-2">{% trans "Recent Notifications" %}</h3>
        <ul class="space-y-2">
            {% for notification in recent_notifications %}
                <li>
                    {{ notification.destinataire.username }} â€“
                    {{ notification.message|truncatechars:50 }}
                    ({{ notification.created_at|date:"SHORT_DATE_FORMAT" }})
                </li>
            {% empty %}
                <li>{% trans "No recent notifications." %}</li>
            {% endfor %}
        </ul>
    </section>
</div>
{% endblock %}
